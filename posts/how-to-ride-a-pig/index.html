<!DOCTYPE html><html><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/snortingcode/component---src-templates-post-template-jsx.d87192e7e6bc9581c41d.css">/*! normalize.css v5.0.0 | MIT License | github.com/necolas/normalize.css */html{font-family:sans-serif;line-height:1.15;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%}body{margin:0}article,aside,footer,header,nav,section{display:block}h1{font-size:2em;margin:.67em 0}figcaption,figure,main{display:block}figure{margin:1em 2.5rem}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace,monospace;font-size:1em}a{background-color:transparent;-webkit-text-decoration-skip:objects}a:active,a:hover{outline-width:0}abbr[title]{border-bottom:none;text-decoration:underline;-webkit-text-decoration:underline dotted;text-decoration:underline dotted}b,strong{font-weight:inherit;font-weight:bolder}code,kbd,samp{font-family:monospace,monospace;font-size:1em}dfn{font-style:italic}mark{background-color:#ff0;color:#000}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}audio,video{display:inline-block}audio:not([controls]){display:none;height:0}img{border-style:none}svg:not(:root){overflow:hidden}button,input,optgroup,select,textarea{font-family:sans-serif;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}[type=reset],[type=submit],button,html [type=button]{-webkit-appearance:button}[type=button]::-moz-focus-inner,[type=reset]::-moz-focus-inner,[type=submit]::-moz-focus-inner,button::-moz-focus-inner{border-style:none;padding:0}[type=button]:-moz-focusring,[type=reset]:-moz-focusring,[type=submit]:-moz-focusring,button:-moz-focusring{outline:1px dotted ButtonText}fieldset{border:1px solid silver;margin:0 .125rem;padding:.35em .625em .75em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{display:inline-block;vertical-align:baseline}textarea{overflow:auto}[type=checkbox],[type=radio]{box-sizing:border-box;padding:0}[type=number]::-webkit-inner-spin-button,[type=number]::-webkit-outer-spin-button{height:auto}[type=search]{-webkit-appearance:textfield;outline-offset:-2px}[type=search]::-webkit-search-cancel-button,[type=search]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details,menu{display:block}summary{display:list-item}canvas{display:inline-block}[hidden],template{display:none}html{font-size:100}body{color:#222;line-height:1.625;font-size:1rem;-ms-text-size-adjust:100%;-webkit-text-size-adjust:100%;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}body,h1,h2,h3,h4,h5,h6{font-family:Roboto,Helvetica Neue,Helvetica,Arial,sans-serif}h1,h2,h3,h4,h5,h6{font-weight:500}h1{font-size:2.5rem;line-height:3.25rem;margin-top:6.5rem;margin-bottom:1.625rem}h2{font-size:1.6875rem;line-height:2.4375rem}h2,h3{margin-top:3.25rem;margin-bottom:.8125rem}h3{font-size:1.375rem;line-height:1.625rem}h4{font-size:1.2rem;margin-top:2.4375rem}h4,h5{line-height:1.625rem;margin-bottom:.8125rem}h5,h6{font-size:1rem;margin-top:4.0625rem}h6{line-height:1.625rem;margin-bottom:.8125rem}img{max-width:100%;margin:inherit auto}hr,img{border:0;display:block}hr{color:#222;height:26px;margin:3.25rem auto;background-size:100% 26px;background-image:linear-gradient(180deg,transparent 1px,transparent 11px,#222 0,#222 15px,transparent 0,transparent 26px);width:6.25rem}a{color:#5d93ff;text-decoration:none}a:active,a:focus,a:hover{color:#f7a046}b,strong{font-weight:500}ul{list-style:square;margin-bottom:1.625rem}ul li{padding:0 .3125rem;margin-bottom:.625rem}p{line-height:1.625rem;margin-bottom:1.625rem}blockquote{padding:0;font-style:italic;text-align:center}figure{display:block;width:100%;height:auto}figcaption{line-height:1.21875rem;margin-top:.40625rem;color:#222;font-size:.875rem;font-style:italic;margin-bottom:0;text-align:center}.layout{max-width:66.875rem;margin-left:auto;margin-right:auto}.layout:after,.layout:before{content:"";display:table}.layout:after{clear:both}.content__inner{padding:1.5625rem 1.25rem}@media screen and (min-width:685px){figure.float-left,figure.float-right{max-width:19.375rem;padding:0 1.625rem}.float-right{float:right}.float-left{float:left}.content{width:calc(58.275% - .78125rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(12n){margin-right:0;float:right}.content:nth-child(12n+1){clear:both}.content__inner{padding:1.875rem 1.25rem}}@media screen and (min-width:960px){.content{width:calc(66.6% - .625rem)}.content:nth-child(1n){float:left;margin-right:1.875rem;clear:none}.content:last-child{margin-right:0}.content:nth-child(3n){margin-right:0;float:right}.content:nth-child(3n+1){clear:both}.content__inner{padding:2.5rem 2.1875rem}}code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#a67f59;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}.tags__list-item-link{color:#222}.tags__list-item-link:focus,.tags__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.categories__list-item-link{color:#222}.categories__list-item-link:focus,.categories__list-item-link:hover{color:#5d93ff;border-bottom:1px solid #5d93ff}.post-single__inner{max-width:59.0625rem;padding:0 .9375rem;margin:0 auto}.post-single__title{font-size:2rem;max-width:40rem;font-weight:600;text-align:center;line-height:2.68125rem;margin:1.625rem auto 0}.post-single__body figure{margin-bottom:1.625rem}.post-single__body figure blockquote{font-style:italic;text-align:center;margin-top:0;padding:1.625rem 0}.post-single__body figure blockquote p{max-width:40rem;font-size:1.6817rem;margin-top:0;margin-bottom:1.625rem;line-height:2.4375rem}.post-single__body a{text-decoration:underline}.post-single__body .gatsby-highlight{max-width:40rem;margin-left:.9375rem;margin-right:.9375rem;margin-bottom:1.625rem}.post-single__body :not(div){max-width:40rem;margin-left:auto;margin-right:auto}.post-single__footer{max-width:40rem;line-height:1.625rem;margin:1.625rem .9375rem 3.25rem}.post-single__footer-text a{text-decoration:underline}.post-single__date{max-width:40rem;margin-left:auto;margin-right:auto}.post-single__tags{margin-bottom:.8125rem}.post-single__tags-list{list-style:none;margin:0 -.3125rem;padding:0}.post-single__tags-list-item{display:inline-block;margin:.625rem .3125rem}.post-single__tags-list-item-link{background:#ebebeb;text-decoration:none;border:0;border-radius:.1875rem;color:#555;line-height:1.625;padding:.5rem 1rem}.post-single__tags-list-item-link:focus,.post-single__tags-list-item-link:hover{color:#222;background:#dfdfdf;border:0}.post-single__home-button{display:block;margin-left:auto;margin-right:auto;max-width:5.625rem;font-size:1rem;padding:0 1rem;height:35px;line-height:2.1875rem;text-align:center;color:#555;background:#ebebeb;font-weight:400;border-radius:.1875rem;margin-top:1.625rem}.post-single__home-button:focus,.post-single__home-button:hover{color:#222;background:#dfdfdf;border:0}@media screen and (min-width:685px){.post-single__body .gatsby-highlight,.post-single__footer{margin-left:auto;margin-right:auto}}@media screen and (min-width:960px){.post-single__inner{padding:0}.post-single__title{font-size:3rem;line-height:3.65625rem;margin-top:3.65625rem;margin-bottom:2.4375rem}.post-single__body,.post-single__body p{font-size:1.125rem;line-height:1.82813rem;margin-bottom:1.82813rem}.post-single__home-button{position:fixed;max-width:auto;margin:0;top:30px;left:30px}}</style><meta name="generator" content="Gatsby 2.0.22"/><link rel="alternate" type="application/rss+xml" href="/snortingcode/rss.xml"/><link href="https://fonts.googleapis.com/css?family=Roboto:400,400i,500,700" rel="stylesheet"/><link rel="sitemap" type="application/xml" href="/snortingcode/sitemap.xml"/><title data-react-helmet="true">How To Ride A Pig! - Snorting Code, Et al.</title><meta data-react-helmet="true" name="description" content="I don&#x27;t take myself too seriously!"/><link as="script" rel="preload" href="/snortingcode/webpack-runtime-d83c116a71878c2dad59.js"/><link as="script" rel="preload" href="/snortingcode/app-8ab4cffe004882682eef.js"/><link as="script" rel="preload" href="/snortingcode/0-67c09113654780576fac.js"/><link as="script" rel="preload" href="/snortingcode/3-449755f3954bae9e5e9a.js"/><link as="script" rel="preload" href="/snortingcode/component---src-templates-post-template-jsx-357bb4275cbc4d79dd0c.js"/><link rel="preload" href="/snortingcode/static/d/96/path---posts-how-to-ride-a-pig-e-13-e88-q9qoW5mcHlRaXk2x64AEqLEwh8.json" as="fetch" crossOrigin="use-credentials"/></head><body><div id="___gatsby"><div style="outline:none" tabindex="-1" role="group"><div class="layout"><div><div><div><a class="post-single__home-button" href="/snortingcode/">All Articles</a></div><div class="post-single"><div class="post-single__inner"><h1 class="post-single__title">How To Ride A Pig!</h1><div class="post-single__body"><p>I was skeptical about using PIG. I mean, why should I be using a (limited?) set of statements when I can actually do as much (and as little) as I want to do while writing MapReduce jobs with Java! To cut a long story short, I’m a fan of Pig now. It has it’s problems but for most problems that the world has to offer, it works like a charm.
When to use:If you google the phrase “When to use pig over MR” you would get a million perspectives/opinions. The best I found was this flow-chart (don’t remember the source, please point me to it if you can):</p>
<p>Now, that we have the holy grail of all questions about Pig out of our way, let’s explore it a little bit.
InstallationThe installation guide walks you through the process. Personally, I found it exceptionally helpful to have the Pig plugin for eclipse (all it does is highlight my Pig Latin scripts but, even that is great help!) and write the code there. Writing the PigUnit test cases becomes easier then.</p>
<h1>Sample Pig script</h1>
<p>Here’s a simple Pig script that does the following:</p>
<ol>
<li>Load a file with structured data into an ‘alias’ (think of them as variables that store the schema of the file that is loaded.</li>
<li>Pickup a few columns from this file and do some manipulation on them.</li>
<li>Store the result into another file.</li>
</ol>
<div class="gatsby-highlight" data-language="pig"><pre class="language-pig"><code class="language-pig">--These are single line comments!
--Load a file into an alias
sample_raw = LOAD &#39;&#39;input.txt&#39;&#39; AS     (name:chararray, age:int, doge_score:int, hipster_score:int) USING PigStorage(&#39;&#39;,&#39;&#39;) ;

--Do some manipulations
sample_man = FOREACH sample_raw GENERATE     name, (doge_score + hipster_score) AS total_score ;

--Store the results into a file
STORE sample_man INTO &#39;&#39;sample_man.csv&#39;&#39; USING PigStorage(&#39;&#39;,&#39;&#39;) ; </code></pre></div>
<p>Though the script looks embarrassingly simple, a lot is happening under the hoods. Let’s start by defining some terminology:</p>
<blockquote>
<p>Bag - Think of that as a table in the relational world. It is a collection of tuples.</p>
</blockquote>
<blockquote>
<p>Tuples - These are the individual records that a ”Bag’ contains.</p>
</blockquote>
<blockquote>
<p>Columns - The columns inside a tuple.</p>
</blockquote>
<p>One important thing to consider is that Pig interpreter ultimately creates MR jobs and runs them. However, the MR jobs are run only for statements like <code class="language-text">STORE</code> and <code class="language-text">DUMP</code>. Before that all that the script does is define schema for the file to be read and all manipulations are done using those schema. No file is read (however, if the file does not exist, your script will throw an exception).
So, the <code class="language-text">LOAD</code> statement defines a schema for the Bag and stores it into an ”alias’ <code class="language-text">sample_raw</code>. The part of that statement in “( )” is not required but it is useful so that you can call your fields with names instead of using positional notation like “<code class="language-text">$0</code>, <code class="language-text">$1</code>” etc.
The <code class="language-text">FOREACH</code> statement would run through all the Tuples and manipulate them for us (this is the part that carries the logic that you would otherwise write in a mapper). Important to remember that even here no MR job is actually run till the script encounters a <code class="language-text">STORE/DUMP</code> statement.
Finally, the STORE statement would run a MR job and store the results into the <code class="language-text">sample_man</code> directory (The results file should be something like “<code class="language-text">sample_man/part-m-00000</code>”).
Easy! Let’s take a look at testing this script now.</p>
<h1>PigUnit</h1>
<p>The PigUnit test framework is built on JUnit (yes, here you get to write some Java finally!) I would say that it is a work in progress because it comes with a lot of restrictions (as of version 0.13.0) but, it still works for most cases. </p>
<h2>Unit test strategy</h2>
<p>Here’s what I think is the best way to go about testing a Pig script:</p>
<ol>
<li>Have an input file with sample input (most examples show a String[] input/output, I think it defeats the purpose).</li>
<li>LOAD the input into the alias by using the PigTest.override() method and passing the same query used in the script.</li>
<li>Use the output file to compare with the alias.</li>
</ol>
<p>Here’s a piece of sample code for the above script:</p>
<div class="gatsby-highlight" data-language="java"><pre class="language-java"><code class="language-java">List<span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">></span></span> outputList <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">ArrayList</span><span class="token generics function"><span class="token punctuation">&lt;</span>String<span class="token punctuation">></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
File outputFile <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">File</span><span class="token punctuation">(</span>PATH_TO_TEST_OUTPUT_FILE<span class="token punctuation">)</span><span class="token punctuation">;</span>
Scanner sc <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Scanner</span><span class="token punctuation">(</span>outputFile<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">while</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">hasNext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    outputList<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>sc<span class="token punctuation">.</span><span class="token function">nextLine</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
sc<span class="token punctuation">.</span><span class="token function">close</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
String<span class="token punctuation">[</span><span class="token punctuation">]</span> output <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
output <span class="token operator">=</span> outputList<span class="token punctuation">.</span><span class="token function">toArray</span><span class="token punctuation">(</span>output<span class="token punctuation">)</span><span class="token punctuation">;</span>
test<span class="token punctuation">.</span><span class="token function">assertOutput</span><span class="token punctuation">(</span><span class="token string">"producer_raw"</span><span class="token punctuation">,</span> input<span class="token punctuation">,</span> <span class="token string">"producer_clean"</span><span class="token punctuation">,</span> output<span class="token punctuation">)</span><span class="token punctuation">;</span> </code></pre></div>
<p>(The PigTest, sadly, has a bunch of flavors of assertOutput but, they are not perfect. There is a method to test an alias against a file but it does not let me assign input to another alias at the same time. The method used above expects the last argument to be a String[]. The PigTest.override() method only takes a query for the second parameter and there is not way to assign an input there to an alias.)
One major advantage of using this approach of testing is that your test scripts remain more or less generic. Just pass the appropriate test input file and a corresponding test output file and you can sit back and watch your pig grunt away to glory!
Gotchas
Be careful with “;” at the end of a %DECLARE statement. It might become a part of the variable that you are declaring!
DEFINE does verbatim substitution. This is just a lexical substitution, the execution of say a UDF DEFINEd in the script would happen only inside the FOREACH. This can lead to problems when you wish to generate a unique value for a column per-file that you process that remain constant for all the records in that file.
Scalar assignment works with %DECLARE
Pig/PigUnit works in two modes - local and MapReduce. By default it runs in MapReduce mode!
The parser is not very intuitive. Test the script with DESCRIBE alias ; if you run into problems.
Accessing tuples inside a bag can vary based on the context - Bag::field<em>in</em>tuple, Bag.field<em>in</em>tuple.
Avoid copy-paste of column names, etc. from a rich-text editor. One of the worst bugs I encountered were the ones where a freak character was copied by accident into my script! Again, the exceptions that you would get are not very intuitive.</p></div><div class="post-single__date"><em>Published <!-- -->27 Nov 2014</em></div></div><div class="post-single__footer"><div class="post-single__tags"><ul class="post-single__tags-list"><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/snortingcode/tags/pig/">pig</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/snortingcode/tags/hadoop/">hadoop</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/snortingcode/tags/apachepig/">apachepig</a></li><li class="post-single__tags-list-item"><a class="post-single__tags-list-item-link" href="/snortingcode/tags/pigunit/">pigunit</a></li></ul></div><hr/><p class="post-single__footer-text">I don&#x27;t take myself too seriously!<a href="https://twitter.com/prasoonj" target="_blank" rel="noopener noreferrer"><br/> <strong>Prasoon</strong> on Twitter</a></p><div><div><div id="disqus_thread"></div></div></div></div></div></div></div></div></div></div><script>
  
  
  if(true) {
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  }
  if (typeof ga === "function") {
    ga('create', 'UA-73379983-2', 'auto', {});
      
      }
      </script><script id="gatsby-script-loader">/*<![CDATA[*/window.page={"componentChunkName":"component---src-templates-post-template-jsx","jsonName":"posts-how-to-ride-a-pig-e13","path":"/posts/how-to-ride-a-pig"};window.dataPath="96/path---posts-how-to-ride-a-pig-e-13-e88-q9qoW5mcHlRaXk2x64AEqLEwh8";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"app":["/app-8ab4cffe004882682eef.js"],"component---node-modules-gatsby-plugin-offline-app-shell-js":["/component---node-modules-gatsby-plugin-offline-app-shell-js-75ac8e86c1cf4c1e89e8.js"],"component---src-templates-page-template-jsx":["/component---src-templates-page-template-jsx.bd3413590f4031314c23.css","/component---src-templates-page-template-jsx-44ec9394cbdc364523eb.js"],"component---src-templates-post-template-jsx":["/component---src-templates-post-template-jsx.d87192e7e6bc9581c41d.css","/component---src-templates-post-template-jsx-357bb4275cbc4d79dd0c.js"],"component---src-templates-category-template-jsx":["/component---src-templates-category-template-jsx.69a945a11e23dfafac91.css","/component---src-templates-category-template-jsx-6d26d68beb6ccb055149.js"],"component---src-templates-tag-template-jsx":["/component---src-templates-tag-template-jsx.69a945a11e23dfafac91.css","/component---src-templates-tag-template-jsx-356b820928914f5c3e07.js"],"component---src-pages-404-jsx":["/component---src-pages-404-jsx-68f8d44b6c86c24cae96.js"],"component---src-pages-categories-jsx":["/component---src-pages-categories-jsx-26bd3cb76a5a520d8880.js"],"component---src-pages-index-jsx":["/component---src-pages-index-jsx.69a945a11e23dfafac91.css","/component---src-pages-index-jsx-b42389bb6649d222fbac.js"],"component---src-pages-tags-jsx":["/component---src-pages-tags-jsx-fff49ebe6b1593dd4f9d.js"]};/*]]>*/</script><script src="/snortingcode/component---src-templates-post-template-jsx-357bb4275cbc4d79dd0c.js" async=""></script><script src="/snortingcode/3-449755f3954bae9e5e9a.js" async=""></script><script src="/snortingcode/0-67c09113654780576fac.js" async=""></script><script src="/snortingcode/app-8ab4cffe004882682eef.js" async=""></script><script src="/snortingcode/webpack-runtime-d83c116a71878c2dad59.js" async=""></script></body></html>